Прототип : История актуальных телефонов клиента

1. Разработать SQL-скрипт построения объекта-приёмника с историей телефонов-клиентов физлиц;
2. Описать алгоритм построения объекта-приёмника в формате ТИС (Требования к Информационной Системе);
3. Сформировать маппинг построения объекта в формате карты отображения;
4. Выполнить бизнес-проверки качества данных полученного прототипа.

Допущения:

1. Построение прототипа выполняется в синтаксисе СУБД PostgreSQL;
2. Глобальный клиент, также известный как унифицированный клиент, золотой клиент, единый клиент - это запись о клиенте, собранная из разных источник, предполагающая по некоторым внутренним правилам, что несколько клиентов из разных систем-источников, это на самом деле один и тот же клиент.

Бизнес-требования:

Необходимо сформировать объект dfct_phone со следующим атрибутивным составом:
mdm_customer_rk			int8		ключ глобального клиента MDM
phone_type_cd			text		тип телефона
business_start_dt		timestamp(0)	Дата начала версии
business_start_dt		timestamp(0)	Дата начала версии
business_start_dt		timestamp(0)	Дата начала версии
business_end_dt			timestamp(0)	Дата окончания версии
business_end_dt			timestamp(0)	Дата окончания версии
business_end_dt			timestamp(0)	Дата окончания версии
phone_num			text		Номер телефона клиента
notification_flg		bool		флаг телефона для нотификаций
atm_flg				bool		флаг телефона, собранного через ATM
trust_system_flg		bool		флаг доверительного источника
duplication_flg			bool		флаг наличия телефона у нескольких клиентов
main_dup_flg			bool		флаг основного клиента для этого телефона
main_phone_flg			bool		флаг лучшего телефона для клиента


1. В качестве источника клиентских данных необходимо использовать данные только унифицированной системы MDM (src_cd='MDMP')
2. В качестве источника контактных данных необходимо использовать источники MDMP, RTLL, RTLS, CFTB, WAYN
3. Отбираются только клиенты с типом "физическое лицо"
4. Отбираются только клиенты, у которых есть глобальный ключ MDM
5. Приёмник должен содержать историчность, т.е. быть версионным, в т.ч. учитывать пересечения версий из отдельных используемых объектов-источников
6. Порядок приоритизации для дедупликации, а также для расчёта main-флагов:

 a. наличие телефона у других клиентов (актуально только для расчёта основного телефона клиента)
 b. trust_system_flg: значение true "лучше" false
 c. contact_qualify_code: любые коды, содержащие GOOD, лучше прочих, но все вариации GOOD равнозначны
 d. система источник: MDMP > WAYN > RTLL > RTLS > CFTB
 e. тип контакта: NotificPhone > ATMPhone > MobilePersonalPhone > MobileWorkNumber > HomePhone 
 f. дата появления версии: более свежая запись лучше

7. В базе данных доступны следующие объекты-источники, подходящие для построения целевого приёмника:
 a. counterparty (Клиенты)
 b. dict_counterparty_type_cd (Справочник типов клиента)
 c. counterparty_x_uniq_counterparty (Связь глобального и локального клиентов)
 d. counterparty_contact (Телефоны клиента)

DDL и инсерты для таблиц источников в приложении (dfct_phone all ddl)

